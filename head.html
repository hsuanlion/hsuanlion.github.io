<script>

var g_current_category = "All";
var g_current_article_title = "";

function convert_markdown_to_html(markdown) {
	var converter = new showdown.Converter();
	converter.setOption('parseImgDimensions', true);
	converter.setOption('tables', true);
	converter.setOption('strikethrough', true);
	converter.setOption('simpleLineBreaks', true);
	
    var text      = markdown;
    var html      = converter.makeHtml(text);
	return html;
}

function show_current_aritcle(){
	$("#content").empty();
	$.each(articles, function( index, article ){
		
		if (g_current_article_title == article.title )
		{	

			$("#content").append(			
				'<div class="article">' + 
				'<h1>' + article.title + '</h1>'+
				'<div class="date"' + article.date + '</div>' +
				'<div class="author">' + article.author + '</div>' +
				'<hr class="line">' +
				article.html + 
				'</div>');
		}	

	});
}

function refresh_aritcle_list(category){
	$("#content").empty();
	$.each(articles, function( index, article ){
		
		if (category == article.category || category == "All")
		{	
			var url = new URL(window.location.href);
			var article_link = url.origin + url.pathname + '?a=' + encodeURI(article.title);

			$("#content").append(
				'<div class="articlelist">' +
				'<a href=' + article_link +'>' +
				'<h1>' + article.title + '</h1>' +
				'<span class="article_description">' + $(article.html).text().slice(0, 100) +'</span>' +
				'</a>'+
				'</div>');
		}	

	});
}


function load_articles (){

	var processed_count = 0;

	$.each(articles, function( index, value ) {

  		console.log(index + ": " + value.link);

  		jQuery.get(value.link, function(data) {
    	
    		value.html = convert_markdown_to_html(data);
  
    		if ( ++processed_count == articles.length){

    			if(g_current_article_title){
    				show_current_aritcle()
    			} else {
    				refresh_aritcle_list(g_current_category);
    			}
    		}
    	});
	});
}


$(function() {
	/* The DOM is now loaded and can be manipulated. */
	var url_string = window.location.href; //window.location.href  
	var url = new URL(url_string);
	var article_title = url.searchParams.get("a");
	if (article_title) {
		g_current_article_title = decodeURI(article_title);
	}
	load_articles();	
	
});

</script>